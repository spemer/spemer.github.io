I"¾N<h3 id="ì‚¬ì´íŠ¸ë§µ-ìƒì„±ë¶€í„°-ê²€ìƒ‰ì—”ì§„-ìƒ‰ì¸-ìš”ì²­ê¹Œì§€">ì‚¬ì´íŠ¸ë§µ ìƒì„±ë¶€í„°, ê²€ìƒ‰ì—”ì§„ ìƒ‰ì¸ ìš”ì²­ê¹Œì§€</h3>

<p>ì•ˆë…•í•˜ì„¸ìš”! ë¼ì´ë¸Œ ë§ˆì¼“ ëª¨ìŒ ì•±, ë³¼ë¼ì˜ ë””ìì´ë„ˆ ì„œí˜ì…ë‹ˆë‹¤. ë³¼ë¼ëŠ” ì…€ëŸ¬(íŒë§¤ì)ì™€ êµ¬ë§¤ìê°€ ë¼ì´ë¸Œ ë°©ì†¡ì„ í†µí•´ ì†Œí†µí•˜ë©° ìƒí’ˆì„ êµ¬ë§¤í•  ìˆ˜ ìˆëŠ” í”Œë«í¼ì…ë‹ˆë‹¤.</p>

<p>ì–¼ë§ˆ ì „, ê¸°ì¡´ <a href="https://vuejs.org/">Vue.js</a>ë¡œ ë§Œë“¤ì–´ì ¸ìˆë˜ ë³¼ë¼ ëœë”©í˜ì´ì§€(https://volla.live)ë¥¼ ì•± ë‚´ ì½˜í…ì¸  ê³µìœ ìš© ë¸Œë¦¿ì§€ í˜ì´ì§€(<a href="https://nextjs.org/">Next.js</a>)ì— í†µí•©í•˜ê²Œ ë˜ë©´ì„œ í•¨ê»˜ ì§„í–‰í•œ ê²€ìƒ‰ì—”ì§„ ìµœì í™”(SEO) ì‘ì—… - ê·¸ì¤‘ì—ì„œë„ ì‚¬ì´íŠ¸ë§µ ì‘ì—… ì¤‘ì— ì§„í–‰í–ˆë˜, Next.js ë™ì  sitemap generator ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±ê¸°ë¥¼ ê³µìœ í•˜ê³ ì í•©ë‹ˆë‹¤.</p>

<hr />

<h3 id="1-nextjsì˜-í´ë”êµ¬ì¡°ë¥¼-í™œìš©í•œ-sitemap-generator-ìŠ¤í¬ë¦½íŠ¸-ì‘ì„±">1. Next.jsì˜ í´ë”êµ¬ì¡°ë¥¼ í™œìš©í•œ sitemap generator ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±â€‹</h3>

<p>Next.jsëŠ” pages ë””ë ‰í† ë¦¬ ë‚´ì˜ í´ë”ì™€ íŒŒì¼ëª…ì„ ë”°ë¼ URLì´ ìƒì„±ë˜ë¯€ë¡œ, globbyë¥¼ ì‚¬ìš©í•´ pages ë””ë ‰í† ë¦¬ì˜ ëª¨ë“  í´ë”ì™€ íŒŒì¼ëª…ë“¤ ì¤‘ Next.jsë§Œì˜ íŠ¹ìˆ˜í•œ íŒŒì¼ëª…ë“¤ (_document.js, _app.js ë“±)ì„ ì œì™¸í•œ ë‚˜ë¨¸ì§€ í´ë” ë° íŒŒì¼ëª…ë“¤ë¡œ ì‚¬ì´íŠ¸ë§µ xmlì´ ë§Œë“¤ì–´ì§€ë„ë¡ ì½”ë“œë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.</p>

<p>ìš°ì„  ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì—ì„œ scripts í´ë”ë¥¼ ë§Œë“¤ê³ , ê·¸ ì•ˆì— sitemap-common.jsë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì•„ë˜ì™€ ê°™ì€ ì½”ë“œë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">fs</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">globby</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">globby</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">prettier</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">prettier</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">getDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">();</span>

<span class="kd">const</span> <span class="nx">YOUR_AWESOME_DOMAIN</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://website.com</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">formatted</span> <span class="o">=</span> <span class="nx">sitemap</span> <span class="o">=&gt;</span> <span class="nx">prettier</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">sitemap</span><span class="p">,</span> <span class="p">{</span> <span class="na">parser</span><span class="p">:</span> <span class="dl">"</span><span class="s2">html</span><span class="dl">"</span> <span class="p">});</span>

<span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">pages</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">globby</span><span class="p">([</span>
    <span class="c1">// include</span>
    <span class="dl">"</span><span class="s2">../pages/**/*.tsx</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">../pages/*.tsx</span><span class="dl">"</span><span class="p">,</span>
    <span class="c1">// exclude</span>
    <span class="dl">"</span><span class="s2">!../pages/_*.tsx</span><span class="dl">"</span>
  <span class="p">]);</span>

  <span class="kd">const</span> <span class="nx">pagesSitemap</span> <span class="o">=</span> <span class="s2">`
    </span><span class="p">${</span><span class="nx">pages</span>
      <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">page</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">page</span>
          <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">"</span><span class="s2">../pages/</span><span class="dl">"</span><span class="p">,</span> <span class="dl">""</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="dl">"</span><span class="s2">.tsx</span><span class="dl">"</span><span class="p">,</span> <span class="dl">""</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">\/</span><span class="sr">index/g</span><span class="p">,</span> <span class="dl">""</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">routePath</span> <span class="o">=</span> <span class="nx">path</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">index</span><span class="dl">"</span> <span class="p">?</span> <span class="dl">""</span> <span class="p">:</span> <span class="nx">path</span><span class="p">;</span>
        <span class="k">return</span> <span class="s2">`
          &lt;url&gt;
            &lt;loc&gt;</span><span class="p">${</span><span class="nx">YOUR_AWESOME_DOMAIN</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="nx">routePath</span><span class="p">}</span><span class="s2">&lt;/loc&gt;
            &lt;lastmod&gt;</span><span class="p">${</span><span class="nx">getDate</span><span class="p">}</span><span class="s2">&lt;/lastmod&gt;
          &lt;/url&gt;
        `</span><span class="p">;</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">""</span><span class="p">)}</span><span class="s2">
  `</span><span class="p">;</span>

  <span class="kd">const</span> <span class="nx">generatedSitemap</span> <span class="o">=</span> <span class="s2">`
    &lt;?xml version="1.0" encoding="UTF-8"?&gt;
    &lt;urlset
      xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd"
    &gt;
      </span><span class="p">${</span><span class="nx">pagesSitemap</span><span class="p">}</span><span class="s2">
    &lt;/urlset&gt;
  `</span><span class="p">;</span>

  <span class="kd">const</span> <span class="nx">formattedSitemap</span> <span class="o">=</span> <span class="p">[</span><span class="nx">formatted</span><span class="p">(</span><span class="nx">generatedSitemap</span><span class="p">)];</span>

  <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="dl">"</span><span class="s2">../public/sitemap-common.xml</span><span class="dl">"</span><span class="p">,</span> <span class="nx">formattedSitemap</span><span class="p">,</span> <span class="dl">"</span><span class="s2">utf8</span><span class="dl">"</span><span class="p">);</span>
<span class="p">})();</span>
</code></pre></div></div>

<p>ìœ„ì˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´, ì•„ë˜ì™€ ê°™ì€ xml íŒŒì¼ì„ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤(ì˜ˆì‹œ).</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;urlset</span>
  <span class="na">xmlns=</span><span class="s">"http://www.sitemaps.org/schemas/sitemap/0.9"</span>
  <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd"</span>
<span class="nt">&gt;</span>
  <span class="nt">&lt;url&gt;</span>
    <span class="nt">&lt;loc&gt;</span>https://website.com/<span class="nt">&lt;/loc&gt;</span>
    <span class="nt">&lt;lastmod&gt;</span>2020-04-03T08:19:25.691Z<span class="nt">&lt;/lastmod&gt;</span>
  <span class="nt">&lt;/url&gt;</span>
  <span class="nt">&lt;url&gt;</span>
    <span class="nt">&lt;loc&gt;</span>https://website.com/about<span class="nt">&lt;/loc&gt;</span>
    <span class="nt">&lt;lastmod&gt;</span>2020-04-03T08:19:25.691Z<span class="nt">&lt;/lastmod&gt;</span>
  <span class="nt">&lt;/url&gt;</span>
  <span class="nt">&lt;url&gt;</span>
    <span class="nt">&lt;loc&gt;</span>https://website.com/blog<span class="nt">&lt;/loc&gt;</span>
    <span class="nt">&lt;lastmod&gt;</span>2020-04-03T08:19:25.691Z<span class="nt">&lt;/lastmod&gt;</span>
  <span class="nt">&lt;/url&gt;</span>
  <span class="nt">&lt;url&gt;</span>
    <span class="nt">&lt;loc&gt;</span>https://website.com/profile<span class="nt">&lt;/loc&gt;</span>
    <span class="nt">&lt;lastmod&gt;</span>2020-04-03T08:19:25.691Z<span class="nt">&lt;/lastmod&gt;</span>
  <span class="nt">&lt;/url&gt;</span>
  <span class="nt">&lt;url&gt;</span>
    <span class="nt">&lt;loc&gt;</span>https://website.com/teams<span class="nt">&lt;/loc&gt;</span>
    <span class="nt">&lt;lastmod&gt;</span>2020-04-03T08:19:25.691Z<span class="nt">&lt;/lastmod&gt;</span>
  <span class="nt">&lt;/url&gt;</span>
<span class="nt">&lt;/urlset&gt;</span>
</code></pre></div></div>

<hr />

<h3 id="2-ì™¸ë¶€-apië¥¼-ìœ„í•œ-sitemap-generator-ìŠ¤í¬ë¦½íŠ¸-ì‘ì„±">2. ì™¸ë¶€ APIë¥¼ ìœ„í•œ sitemap generator ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±</h3>

<p>ìœ„ì˜ ì˜ˆì œ ì½”ë“œì™€ ê°™ì´, ì •ì  í˜ì´ì§€ë“¤ì— ëŒ€í•´ì„œëŠ” ì‚¬ì´íŠ¸ë§µì„ ë§Œë“¤ì–´ì£¼ê¸°ê°€ ë¹„êµì  ì‰½ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ, ë™ì  í˜ì´ì§€ë“¤(e.g. userId ë“±ì„ ë°›ì•„ì„œ í˜ì´ì§€ë¥¼ ë„ì›Œì£¼ëŠ”)ì— ëŒ€í•´ì„œëŠ” ì¡°ê¸ˆ ë‹¤ë¥¸ ë°©ì‹ì„ í†µí•´ ì‚¬ì´íŠ¸ë§µì„ ìƒì„±í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•´ì•¼ í–ˆìŠµë‹ˆë‹¤(ì˜ˆì œ ì½”ë“œì—ì„œëŠ” <a href="https://jsonplaceholder.typicode.com/">JSONPlaceholder</a>ì˜ API ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤).</p>

<p>sitemap-posts.jsë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì•„ë˜ì™€ ê°™ì€ ì½”ë“œë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.</p>

<p>{% highlight javascript %}
const fs = require(â€œfsâ€);
const fetch = require(â€œnode-fetchâ€);
const prettier = require(â€œprettierâ€);</p>

<p>const getDate = new Date().toISOString();</p>

<p>const fetchUrl = â€œhttps://jsonplaceholder.typicode.com/postsâ€;
const YOUR_AWESOME_DOMAIN = â€œhttps://website.comâ€;</p>

<p>const formatted = sitemap =&gt; prettier.format(sitemap, { parser: â€œhtmlâ€ });</p>

<p>(async () =&gt; {
  const fetchPosts = await fetch(fetchUrl)
    .then(res =&gt; res.json())
    .catch(err =&gt; console.log(err));</p>

<p>const postList = [];
  fetchPosts.forEach(post =&gt; postList.push(post.id));</p>

<p>const postListSitemap = `
    ${postList
      .map(id =&gt; {
        return `
          <url>
            <loc>${`${YOUR_AWESOME_DOMAIN}/post/${id}`}</loc>
            <lastmod>${getDate}</lastmod>
          </url><code class="language-plaintext highlighter-rouge">;
      })
      .join("")}
  </code>;</p>

<p>const generatedSitemap = `
    &lt;?xml version=â€1.0â€ encoding=â€UTF-8â€?&gt;
    <urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd">
      ${postListSitemap}
    </urlset>
  `;</p>

<p>const formattedSitemap = [formatted(generatedSitemap)];</p>

<p>fs.writeFileSync(â€œ../public/sitemap-posts.xmlâ€, formattedSitemap, â€œutf8â€);
})();
{% endhighlight %}</p>

<p>ìœ„ì˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´, ì•„ë˜ì™€ ê°™ì€ xml íŒŒì¼ì„ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤(ì˜ˆì‹œ).</p>

<p>{% highlight html %}
&lt;?xml version=â€1.0â€ encoding=â€UTF-8â€?&gt;</p>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.sitemaps.org/schemas/sitemap/0.9 http://www.sitemaps.org/schemas/sitemap/0.9/sitemap.xsd">
  <url>
    <loc>https://website.com/post/1</loc>
    <lastmod>2020-04-03T16:03:19.388Z</lastmod>
  </url>
  <url>
    <loc>https://website.com/post/2</loc>
    <lastmod>2020-04-03T16:03:19.388Z</lastmod>
  </url>
  <url>
    <loc>https://website.com/post/3</loc>
    <lastmod>2020-04-03T16:03:19.388Z</lastmod>
  </url>
  <url>
    <loc>https://website.com/post/4</loc>
    <lastmod>2020-04-03T16:03:19.388Z</lastmod>
  </url>
  <url>
    <loc>https://website.com/post/5</loc>
    <lastmod>2020-04-03T16:03:19.388Z</lastmod>
  </url>
  <url>
    <loc>https://website.com/post/6</loc>
    <lastmod>2020-04-03T16:03:19.388Z</lastmod>
  </url>
  <url>
    <loc>https://website.com/post/7</loc>
    <lastmod>2020-04-03T16:03:19.388Z</lastmod>
  </url>
  <url>
    <loc>https://website.com/post/8</loc>
    <lastmod>2020-04-03T16:03:19.388Z</lastmod>
  </url>
  <url>
    <loc>https://website.com/post/9</loc>
    <lastmod>2020-04-03T16:03:19.388Z</lastmod>
  </url>
  <url>
    <loc>https://website.com/post/10</loc>
    <lastmod>2020-04-03T16:03:19.388Z</lastmod>
  </url>
</urlset>
<p>{% endhighlight %}</p>

<hr />

<h3 id="3-ìœ„ì—ì„œ-ë§Œë“¤ì–´ì§„-ì‚¬ì´íŠ¸ë§µ-íŒŒì¼ë“¤ì„-ëª¨ë‘-gzip-í˜•ì‹ìœ¼ë¡œ-ì••ì¶•í•´ì£¼ëŠ”-ìŠ¤í¬ë¦½íŠ¸-ì‘ì„±">3. ìœ„ì—ì„œ ë§Œë“¤ì–´ì§„ ì‚¬ì´íŠ¸ë§µ íŒŒì¼ë“¤ì„ ëª¨ë‘ gzip í˜•ì‹ìœ¼ë¡œ ì••ì¶•í•´ì£¼ëŠ” ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±</h3>

<p>gzip(.gz) í˜•ì‹ìœ¼ë¡œ ì••ì¶•ëœ ì‚¬ì´íŠ¸ë§µì€ ìš©ëŸ‰ì„ ì¤„ì´ë©´ì„œë„, xml í˜•ì‹ì˜ ì‚¬ì´íŠ¸ë§µê³¼ ë™ì¼í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìœ„ì—ì„œ ë§Œë“¤ì–´ì§„ xml íŒŒì¼ë“¤ì„ zlibì„ ì‚¬ìš©í•´ì„œ ëª¨ë‘ gzip í˜•ì‹ìœ¼ë¡œ ì••ì¶•í•˜ê² ìŠµë‹ˆë‹¤.</p>

<p>{% highlight javascript %}
const fs = require(â€œfsâ€);
const zlib = require(â€œzlibâ€);</p>

<p>var dirs = [â€../public/sitemapâ€];</p>

<p>dirs.forEach((dir) =&gt; {
  fs.readdirSync(dir).forEach((file) =&gt; {
    if (file.endsWith(â€œ.xmlâ€)) {
      // gzip
      const fileContents = fs.createReadStream(dir + â€œ/â€ + file);
      const writeStream = fs.createWriteStream(dir + â€œ/â€ + file + â€œ.gzâ€);
      const zip = zlib.createGzip();</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  fileContents
    .pipe(zip)
    .on("error", (err) =&gt; console.error(err))
    .pipe(writeStream)
    .on("error", (err) =&gt; console.error(err));
}   }); }); {% endhighlight %}
</code></pre></div></div>

<p>ìœ„ì˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´, 1ë²ˆê³¼ 2ë²ˆì—ì„œ ë§Œë“¤ì–´ì§„ xml íŒŒì¼ë“¤ì„ ëª¨ë‘ .gz í˜•ì‹ìœ¼ë¡œ ì••ì¶•í•´ì¤ë‹ˆë‹¤.</p>

<hr />

<h3 id="4-ìœ„ì˜-ë°©ë²•ë“¤ë¡œ-ë§Œë“¤ì–´ì§„-sitemap-íŒŒì¼ë“¤ì„-ìœ„í•œ-ì‚¬ì´íŠ¸ë§µ-ìƒ‰ì¸-íŒŒì¼-ìƒì„±-ìŠ¤í¬ë¦½íŠ¸-ì‘ì„±">4. ìœ„ì˜ ë°©ë²•ë“¤ë¡œ ë§Œë“¤ì–´ì§„ sitemap íŒŒì¼ë“¤ì„ ìœ„í•œ, ì‚¬ì´íŠ¸ë§µ ìƒ‰ì¸ íŒŒì¼ ìƒì„± ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±</h3>

<p>ì—¬ëŸ¬ ê°œì˜ ì‚¬ì´íŠ¸ë§µë“¤ì„ ê²€ìƒ‰ì—”ì§„ì— ì œê³µ(êµ¬ê¸€ ì„œì¹˜ì½˜ì†”, ë„¤ì´ë²„ ì„œì¹˜ ì–´ë“œë°”ì´ì € ë“±)í•˜ê¸° ìœ„í•´ì„œëŠ”, ì‚¬ì´íŠ¸ë§µ ìƒ‰ì¸(Sitemap index) íŒŒì¼ì´ ë³„ë„ë¡œ í•„ìš”í•©ë‹ˆë‹¤.</p>

<p>ë³¼ë¼ì˜ ê²½ìš° <code class="language-plaintext highlighter-rouge">/seller/[_id]</code>, <code class="language-plaintext highlighter-rouge">/product/[_id]</code>, <code class="language-plaintext highlighter-rouge">/video/[_id]</code> ë“± ë‹¤ì–‘í•œ ë™ì  ì›¹í˜ì´ì§€ë“¤ì— ëŒ€ì‘í•´ ê°ê° ì‚¬ì´íŠ¸ë§µì„ ë”°ë¡œ ë§Œë“¤ì–´ì£¼ì—ˆìœ¼ë©°, êµ¬ê¸€ ì„œì¹˜ì½˜ì†” ë“±ì— ì‚¬ì´íŠ¸ë§µì„ ì œì¶œí•˜ê¸° ìœ„í•´ì„œëŠ” ë‹¨ì¼ ì‚¬ì´íŠ¸ë§µìœ¼ë¡œ ì œì¶œí•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì•„ë˜ì™€ ê°™ì€ ì½”ë“œë¥¼ ì‘ì„±í•´ì„œ ì‚¬ì´íŠ¸ë§µ ìƒ‰ì¸ íŒŒì¼ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.</p>

<p>{% highlight javascript %}
const fs = require(â€œfsâ€);
const globby = require(â€œglobbyâ€);
const prettier = require(â€œprettierâ€);</p>

<p>const getDate = new Date().toISOString();</p>

<p>const webrootDomain = â€œhttps://website.comâ€;</p>

<p>const formatted = sitemap =&gt; prettier.format(sitemap, { parser: â€œhtmlâ€ });</p>

<p>(async () =&gt; {
  const pages = await globby([â€../public/sitemap/*.gzâ€]);</p>

<p>const sitemapIndex = `
    ${pages
      .map(page =&gt; {
        const path = page.replace(â€œ../public/â€, â€œâ€);
        return `
          <sitemap>
            <loc>${`${webrootDomain}/${path}`}</loc>
            <lastmod>${getDate}</lastmod>
          </sitemap><code class="language-plaintext highlighter-rouge">;
      })
      .join("")}
  </code>;</p>

<p>const sitemap = `
    &lt;?xml version=â€1.0â€ encoding=â€UTF-8â€?&gt;
    <sitemapindex xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
      ${sitemapIndex}
    </sitemapindex>
  `;</p>

<p>const formattedSitemap = [formatted(sitemap)];</p>

<p>fs.writeFileSync(â€œ../public/sitemap.xmlâ€, formattedSitemap, â€œutf8â€);
})();
{% endhighlight %}</p>

<p>ìœ„ì˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´, ì•„ë˜ì™€ ê°™ì€ xml íŒŒì¼ì„ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤(ì˜ˆì‹œ).</p>

<p>{% highlight html %}
&lt;?xml version=â€1.0â€ encoding=â€UTF-8â€?&gt;</p>
<sitemapindex xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  <sitemap>
    <loc>https://website.com/sitemap/sitemap-common.xml.gz</loc>
    <lastmod>2020-04-03T08:19:46.858Z</lastmod>
  </sitemap>
  <sitemap>
    <loc>https://website.com/sitemap/sitemap-posts.xml.gz</loc>
    <lastmod>2020-04-03T08:19:46.858Z</lastmod>
  </sitemap>
</sitemapindex>
<p>{% endhighlight %}</p>

<hr />

<h3 id="5-ë§ˆìŠ¤í„°-ë°°í¬-ì‹œë§ˆë‹¤-ìƒˆë¡œìš´-ì‚¬ì´íŠ¸ë§µì„-ìƒì„±í•˜ëŠ”-bash-ìŠ¤í¬ë¦½íŠ¸ì™€-github-actionsì—ì„œ-êµ¬ê¸€-search-consoleì—-ì‚¬ì´íŠ¸ë§µì„-ping-í•˜ëŠ”-ìŠ¤í¬ë¦½íŠ¸-ì‘ì„±">5. ë§ˆìŠ¤í„° ë°°í¬ ì‹œë§ˆë‹¤ ìƒˆë¡œìš´ ì‚¬ì´íŠ¸ë§µì„ ìƒì„±í•˜ëŠ” Bash ìŠ¤í¬ë¦½íŠ¸ì™€, GitHub Actionsì—ì„œ êµ¬ê¸€ Search Consoleì— ì‚¬ì´íŠ¸ë§µì„ Ping í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±</h3>

<p>{% highlight bash %}</p>
<h1 id="yarn-sitemap">yarn sitemap</h1>
<p>$ cd public
$ rm -rf sitemap
$ mkdir sitemap
$ cd ..
$ cd scripts
$ node ./sitemap-common.js
$ node ./sitemap-posts.js
$ node ./sitemap.js
{% endhighlight %}</p>

<p>êµ¬ê¸€ ì„œì¹˜ì½˜ì†”ì— í˜ì´ì§€ì˜ ìƒ‰ì¸ì„ ë‹¤ì‹œ ìƒì„±í•˜ë„ë¡ ìš”ì²­í•˜ë ¤ë©´, ì•„ë˜ì˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë§ˆì§€ë§‰ì— ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤.</p>

<p>{% highlight bash %}
$ curl http://google.com/ping?sitemap=http://website.com/sitemap.xml
{% endhighlight %}</p>

<p>ë³¼ë¼ì˜ ê²½ìš°ì—ëŠ” xml í˜•ì‹ì˜ ì‚¬ì´íŠ¸ë§µì„ ë§Œë“  í›„ í•´ë‹¹ ì‚¬ì´íŠ¸ë§µë“¤ì„ gzip í˜•ì‹ìœ¼ë¡œ ì••ì¶•í•œ ë‹¤ìŒ, ê¸°ì¡´ì˜ xml ì‚¬ì´íŠ¸ë§µì„ ì œê±°í•  ìˆ˜ ìˆë„ë¡ ì•„ë˜ì™€ ê°™ì€ bash ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë”°ë¡œ ì‘ì„±í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.</p>

<p><img src="https://blog.kakaocdn.net/dn/bvtUCO/btrdJj7Rnum/lpe5O3PF7Rf38nl7ZlREr0/img.png" alt="Bash script" /></p>

<p>ì´í›„, ë§ˆìŠ¤í„° ë°°í¬ ì‹œ GitHub Actionsì—ì„œ ìœ„ì˜ ìŠ¤í¬ë¦½íŠ¸ë“¤ì„ ì‹¤í–‰í•˜ë„ë¡ workflow íŒŒì¼ì„ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤.</p>

<p>{% highlight bash %}</p>
<h1 id="ì‚¬ì´íŠ¸ë§µì„-ë§Œë“¤ê³ -êµ¬ê¸€ì—-ì œì¶œí•©ë‹ˆë‹¤">ì‚¬ì´íŠ¸ë§µì„ ë§Œë“¤ê³ , êµ¬ê¸€ì— ì œì¶œí•©ë‹ˆë‹¤.</h1>
<ul>
  <li>run: yarn sitemap
name: ping sitemap
{% endhighlight %}</li>
</ul>

<hr />

<h3 id="ì¶”í›„-ë°˜ì˜ê°œì„ í•´ì•¼-í• -ì‚¬í•­">ì¶”í›„ ë°˜ì˜/ê°œì„ í•´ì•¼ í•  ì‚¬í•­</h3>

<ul>
  <li>ë§¤ 00ì‹œ ì •ê°ë§ˆë‹¤ ìë™ìœ¼ë¡œ ì‹ ê·œ ì½˜í…ì¸ ë“¤ì´ ë°˜ì˜ëœ ìƒˆë¡œìš´ ì‚¬ì´íŠ¸ë§µì„ ë§Œë“¤ê³ , ì´í›„ êµ¬ê¸€ì— ìƒˆë¡œìš´ ì‚¬ì´íŠ¸ë§µ ìƒ‰ì¸ Ping</li>
</ul>

<hr />

<h3 id="ë§ˆì¹˜ë©°">ë§ˆì¹˜ë©°</h3>

<p>ê°œë°œì— ëŒ€í•œ ì§€ì‹ì´ ë§ì´ ë¶€ì¡±í•œ í„°ë¼ ì˜ëª»ëœ ë‚´ìš©ì´ ìˆì„ ìˆ˜ë„ ìˆëŠ”ë°, í•´ë‹¹ ë¶€ë¶„ì— ì½”ë©˜íŠ¸ë¥¼ ë‹¬ì•„ì£¼ì‹ ë‹¤ë©´ ë°”ë¡œì¡ì„ ìˆ˜ ìˆë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. í˜¹ì‹œ ìœ„ ë°©ë²•ë³´ë‹¤ ë”ìš± ì¢‹ì€ ë°©ë²•ì´ë‚˜, ê°œì„ ì„ ìœ„í•œ ì˜ê²¬ ë“±ì€ ëŒ“ê¸€ë¡œ ë¶€íƒë“œë¦½ë‹ˆë‹¤. ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤!</p>

:ET